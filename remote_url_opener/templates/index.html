{% load static %}

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr">
	<head>
		<title>Accueil</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta http-equiv="content-language" content="fr" />
		<link href="{% static 'style.css' %}" title="Défaut" rel="stylesheet" type="text/css" media="screen" />
		<script type="text/javascript" src="{% static 'js/prefixfree.min.js' %}"></script>
	</head>
	<body>
		<div id="player-center" class="">
			<div class="title">
				{% if playing %}
					<div class="marquee">
						<span class="now-playing">{{ playing }}</span>	
					</div>
					<span id="compteur_time_left" class="time-left">{{ actual_time_left }}</span>
			
				{% else %}
					<span class="now-playing">No music :'( Add yours now !</span>
				{% endif %}
			</div>

			<div class="separator"></div>

			<!--<h3>Playlist : {{ count_left }} - {{ time_left }}</h3> -->
			<div class="center">
				{% if playing %}
					<h3>Playlist : </h3>
					<div class="playlist bleu-scrollbar">
						{% for music in nexts_music %} 
							<span class="gris">{{music}}</span><br/> 
						{% endfor %}
					</div>
				{% else %}
					<h3>Playlist empty</h3>
				{% endif %}
			</div>

			<div class="separator"></div>

			<div class="add-music">
				<form action="." method="post">
						{% csrf_token %}
						<div class="input-design">
							<input type="text" value="" name="url">
						</div>
						<input class="add-to-queue" type="submit" name="add_url" value="add_to_queue" title="Add to playlist" alt="Add to playlist" />
				</form>
				<form action="." method="post">
					{% csrf_token %}
					<input class="next-music" type="submit" name="play_next" value="Next music" title="Next Music" alt="Next Music" />
				</form>
			</div>		
		</div>

		<div id="vinil" class="vinil vinil-firefox {%if playing%}spin{%endif%}" onclick="test(this)"></div>

		<div id="historique" class="historique-hide no-scrollbar" onclick="test(this)">
			<div id="scrolling">
			{% for music in musics %}
				<li>{{ music.name }} <i>({{ music.get_played_count }})</i></li>
				<form action="." method="post">
					{% csrf_token %}
					<input type="hidden" value="{{ music.video_id }}" name="url">
					<input type="button" name="add_url" value="Add to queue" onClick="delai(this.form)"/>
				</form>
			{% endfor %}
			</div>
		</div>

	</body>
	<script type="text/javascript">
		/*function checkUrl(e){
			console.log(this.getElementByNames("url").item(0).value.length)
		}*/
		function delai(e){
			console.log(e)
			setTimeout(function(){e.submit()},1000)
		}
		function test(e){
			var divVinil = document.getElementById("vinil")
			var divPlayer = document.getElementById("player-center")
			var divHistorique = document.getElementById("historique")
			if (divVinil.className.indexOf("vinil-center") > -1){
				divVinil.className = "vinil vinil-base"
				divPlayer.className = "player-slide-center"
				divHistorique.className = "historique-hide historique-slide-out no-scrollbar"
				{%if playing%}setTimeout(function(){divVinil.className += " spin"}, 1001);{%endif%}
			}
			else {
				divVinil.className = "vinil-center"
				divPlayer.className = "player-slide-hide"
				divHistorique.className = "historique-visible historique-slide-in no-scrollbar"
			}
		}

		{% if playing %}
		var doc = document.getElementById("compteur_time_left")
		var actual_time = "{{actual_time_left}}"
		var split_actual_time = actual_time.split(":")
		var heures = parseInt(split_actual_time[0])
		var minutes = parseInt(split_actual_time[1])
		var secondes = parseInt(split_actual_time[2])
		function compteur() {
			if(secondes == 0) {
				secondes = 59
				if(minutes == 0) {
					minutes = 59
					if(heures == 0)
						window.location.reload()
					else
						heures--
				}
				else
					minutes--
			}
			else {
				secondes--
			}
			if(heures < 10)
				doc.innerHTML = heures+':'
			else
				doc.innerHTML = heures+':'
		  
			if(minutes < 10)
				doc.innerHTML += '0'+minutes+':'
			else
				doc.innerHTML += minutes+':'
		  
			if(secondes < 10)
				doc.innerHTML += '0'+secondes
			else
				doc.innerHTML += secondes
		}
		setInterval("compteur()",1000)
		{% endif %}
	</script>
</html>