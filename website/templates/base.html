{% load static %}
<!DOCTYPE html>
<html>
<head>
  <title>Amoki's Musics</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta http-equiv="content-language" content="fr" />

  <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
  <link href="{% static 'css/style.less' %}" rel="stylesheet/less">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="{% static 'css/jquery-ui.min.css' %}" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.7.3/css/bootstrap-select.min.css">

  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.3.0/knockout-min.js"></script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/less.js/2.5.1/less.min.js"></script>
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script type="text/javascript" src="{% static 'js/lib/js.cookie-2.0.3.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/lib/bootstrap.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/lib/prefixfree.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/lib/ws4redis.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/lib/jquery.plugin.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/lib/jquery.countdown.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/lib/jquery-ui.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/lib/knockout-sortable.min.js' %}"></script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.7.3/js/bootstrap-select.min.js"></script>

  <script type="text/javascript" src="{% static 'js/lib/common_functions.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/remote/knockout.remote.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/remote/ajax.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/remote/usefullFunction.js' %}"></script>
</head>
<body>
  <div id="wrapper">
    <!-- BEGIN LOGIN -->
    <div class="wrapper-login ko-login" data-bind="css: { 'display-none': isConnected }">
      <div class="container col-md-4 col-md-offset-4 LOGIN">
        <div class="header">
          <h3 class="text-muted">Log In</h3>
        </div>
        <div class="jumbotron">
          <h1>Select a room</h1>
          <form class="form-inline" role="form" data-bind="submit: getLogin">
            <div class="form-group">
              <label for="rooms">Rooms:</label>
              <select id="rooms" class="form-control" name="room" data-bind="options: rooms, optionsText: 'name', optionsValue: 'name', value: selectedRoom,"></select>
            </div>
            <div class="form-group">
              <label for="password">Password:</label>
              <input id="password" type="password" name="password" data-bind="value: password">
            </div>
            <button type="submit" class="btn btn-primary">Valider</button>
          </form>
        </div>
      </div>
    </div>
    <!-- END LOGIN -->
    <div class="ko-room">
      <nav id="navbar-top" class="navbar navbar-inverse" role="navigation">
        <div class="container-fluid">
          <!-- Brand and toggle get grouped for better mobile display -->
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
          </div>
          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav" data-bind="with: room">
              <li class="active"><a class="navbar-brand" data-bind="text: name"></a></li>
              <li>
                <a id="btn-navbar" href="/log-out/">
                  <button class="btn btn-primary" type="submit">Change Room</button>
                </a>
              </li>
              <li>
                <a id="btn-navbar" href="/player/" target="_blank">
                  <button class="btn btn-primary" type="submit">Open the player</button>
                </a>
              </li>
            </ul>
          </div><!-- /.navbar-collapse -->
        </div>
      </nav>
    </div>
    <div class="container-fluid ligne">
      <div class="REMOTE">
        <!-- REMOTE ZONE -->
        <div class="col-md-8 ko-room">
          <div class="col-md-offset-1 col-md-10 remote" data-bind="with: room">
            <!-- HEADER REMOTE -->
            <div class="row header-remote">
              <div data-bind="with: currentMusic">
                <img id="thumbnail" class="col-md-offset-1 col-md-3 img-responsive" data-bind="attr: {src: thumbnail}">
                <div class="col-md-8 title_playing">
                  <div class="marquee">
                    <a class="now-playing" data-bind="attr: {href: url}, text: name"></a>
                  </div>
                </div>
              </div>
              <div data-bind="if: !currentMusic">
                <div class="col-md-12 title">
                  <div class="marquee">
                    <span class="now-playing">No music :'( Add yours now !</span>
                  </div>
                </div>
              </div>
            </div>
            <!-- END HEADER REMOTE -->
            <!-- PLAYLIST -->
            <div class="row playlist">
              <div class="col-md-offset-1 col-md-10">
                <div class="wrappeur">
                  <div class="panel panel-default panel-playlist">
                    <div class="panel-heading">
                      <h3 class="panel-title">Playlist</h3>
                    </div>
                        <!-- <div id="overlay-playlist">
                          <i class="fa fa-spinner fa-pulse fa-3x fa-fw loader"></i>
                        </div> -->
                        <table class="table table-striped table-condensed header-fixed">
                          <!-- ko if: playlist().length  -->
                          <tbody id="sortable" class="playlist-ajax" data-bind="sortable: {data: playlist, options: sortableOptions, afterMove: afterMoveSortable}">
                            <tr class="playlist-item">
                              <td data-bind="text: name"></td>
                              <td><span class="badge" data-bind="text: humanizeSeconds(duration())"></span></td>
                              <td>
                                <i class="fa fa-1-5 fa-angle-double-up ordering-to-top" data-action="top" data-bind="visible : $index()!=0" ></i>
                                <i class="fa fa-1-5 fa-angle-up ordering-move-up" data-action="up" data-bind="visible : $index()!=0" ></i>
                                <i class="fa fa-1-5 fa-angle-down ordering-move-down" data-action="down" data-bind="visible: $index() < $parent.playlist().length - 1"></i>
                                <i class="fa fa-1-5 fa-angle-double-down ordering-to-bot" data-action="bottom" data-bind="visible: $index() < $parent.playlist().length - 1"></i>

                                <span class="pull-right">| <i class="fa fa-arrows"></i></span>
                              </td>
                            </tr>
                          </tbody>
                          <!-- /ko -->
                          <!-- ko if: (shuffle() && playlist().length === 0) -->
                          <tbody>
                            <tr class="empty">
                              <td>Shuffle activated...<br /><br />Let the music be your guide</td>
                            </tr>
                          </tbody>
                          <!-- /ko -->
                          <!-- ko if: (!shuffle() && playlist().length === 0) -->
                          <tbody>
                            <tr class="empty">
                              <td>No more musics in the playlist !</td>
                            </tr>
                          </tbody>
                          <!-- /ko -->
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- END PLAYLIST -->
                <!-- PROGRESS BAR -->
                <div class="row">
                  <div class="col-md-offset-1 col-md-10 wrapper-progress-bar">
                    <div class="progress progress-striped active">
                      <div class="progress-bar"></div>

                    </div>
                    <div id="time-left-progress-bar-wrapper">
                      <span id="time-left-progress-bar"></span>
                      <span id="time-left-progress-bar-duration"></span>
                    </div>
                  </div>
                </div>
                <!-- END PROGRESS BAR -->
                <!-- CONTROL BUTTONS -->
                <div class="row">
                  <div class="col-xs-offset-2 col-xs-2">
                    <form data-bind="submit: $parent.patchShuffle">
                      <button type="submit" id="submit-shuffle" class="btn btn-default btn-control" title="Shuffle" alt="Shuffle" 
                      data-bind="css: {'btn-shuffle-false' : !shuffle()}">
                      <i class="fa fa-random fa-2x"></i>
                    </button>
                  </form>
                </div>
                <div class="col-xs-offset-3 col-xs-4">
                  <form data-bind="submit: $parent.postNext">
                    <button id="btn-next" type="submit" title="Next Music" alt="Next Music" class="btn btn-default btn-control"
                    data-bind="enable: currentMusic">
                    <i class="fa fa-fast-forward fa-2x"></i>
                  </button>
                </form>
              </div>
            </div>
            <!-- END CONTROL BUTTONS -->
          </div>
        </div>
        <!-- END REMOTE ZONE -->
        <!-- LIBRARY  -->
        <div class="col-md-4 LIB ko-library">
          <div class="row input-lib">
            <div class="col-lg-12">
              <form class="search-form" data-bind="submit: searchMusic">
                <div class="input-group">
                  <span class="input-group-btn">
                    <select data-width="auto" data-bind="selectPicker: sourceSearch, optionsText: 'name', optionsValue : 'name', selectPickerOptions: { optionsArray: sources }"></select>
                  </span>
                  <input type="text" name="query" class="form-control query" id="querySearch" placeholder="Titre" data-bind="textInput: querySearch">
                  <span class="input-group-btn">
                    <button class="btn btn-default" type="submit"><i class="fa fa-search"></i></button>
                  </span>
                </div>
              </form>
            </div>
          </div>
          <div class="row list-lib">
            <div class="col-md-12">
              <ul class="nav nav-tabs nav-justified">
                <li id="tab_btn_search" data-bind="if: musicSearch().length, css: { 'display-none': musicSearch().length < 1 }"><a data-toggle="tab" href="#search-tab">Search Result</a></li>
                <li id="tab_btn_library" class="active"><a data-toggle="tab" href="#library">Library</a></li>
              </ul>
              <div id="popover-container-custom" class="tab-content">
                <div class="tab-pane" id="search-tab" data-bind="if: musicSearch().length">
                  <ul id="list-search" class="list-group" data-bind="foreach: musicSearch">
                    <li class="list-group-item item-lib row row-list-item">
                      <!-- SEARCH MUSIC DATA -->
                      <div class="row-list-item">
                        <div class="search-img-music">
                          <img data-bind="attr: { src: thumbnail }">
                        </div>
                        <div class="search-music-info">
                          <div class="row">
                            <div class="col-xs-12" style="min-height:45px" data-bind="text: name"></div>
                          </div>
                          <div class="row">
                            <div class="col-xs-8" style="color:black;font-weight:normal;">
                              <span data-bind="text: count"></span>&nbsp;views
                            </div>
                            <div class="col-xs-4">
                              <span class="badge" data-bind="text: humanizeSeconds(duration())"></span>
                            </div>
                          </div>
                        </div>
                        <form class="add-music-form" data-bind="submit: $root.addMusic">
                          <button class="btn btn-default btn-add-music" type="submit" alt="Ajouter à la playlist" title="Ajouter à la playlist">
                            <span class="glyphicon glyphicon-play-circle"></span>
                          </button>
                        </form>
                      </div>
                    </li>
                  </ul>
                </div>
                <div class="tab-pane active" id="library">
                  <ul id="list-library" class="list-group" data-bind="foreach: musicsLibrary">
                    <li class="list-group-item item-lib row row-list-item">
                      <div class="row-list-item">
                        <div class="library-img-music">
                          <img data-bind="attr: { src: thumbnail }">
                        </div>
                        <div class="library-music-info">
                          <div class="row">
                            <div class="col-xs-12" style="min-height:45px" data-bind="text: name"></div>
                          </div>
                          <div class="row">
                            <div class="col-xs-8" style="color:black;font-weight:normal;">
                              Played&nbsp;<span class="bold" data-bind="text: count"></span>&nbsp;times
                            </div>
                            <div class="col-xs-4">
                              <span class="badge" data-bind="text: humanizeSeconds(duration())"></span>
                            </div>
                          </div>
                        </div>
                        <form class="add-music-form" data-bind="submit: $root.addMusic">
                          <button class="btn btn-default btn-add-music" type="submit" alt="Ajouter à la playlist" title="Ajouter à la playlist">
                            <span class="glyphicon glyphicon-play-circle"></span>
                          </button>
                        </form>
                      </div>
                    </li>
                  </ul>
                  <div class="list-group-item row-list-item">
                    <button title="Previous" class="btn btn-default" data-bind="click: getLibrary, value: hasPrevious, enable: hasPrevious" style="margin-right: 30px;">Previous musics</button>
                    <button title="Next" class="btn btn-default" data-bind="click: getLibrary, value: hasNext, enable: hasNext">Next musics</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- END LIBRARY -->
      </div>
    </div>
    <!-- FOOTER  -->
    <footer class="foot ko-room" data-bind="with: room">
      <form class="pull-left" data-bind="submit: $parent.deleteMusic">
        <button id="dead-link" class="btn btn-primary" type="submit" data-bind="enable: currentMusic">Dead link ?</button>
      </form>
      <a class="btn btn-primary pull-right" href="">Company Terms</a>
      <a data-toggle="modal" href="#extensions" class="btn btn-primary pull-right">Extensions</a>
    </footer>
    <!-- END FOOTER -->
  </div>

  <!-- END PAGE -->
  <div class="modal fade modal-on-top" id="modal-next-music">
    <div class="modal-dialog modal-sm">
      <div class="modal-content modal-content-custom">
        <div class="modal-body">
          Skipped !
          <button type="button" class="close" data-dismiss="modal">x</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="extensions">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">x</button>
          <h4 class="modal-title">Les extensions</h4>
        </div>
        <div class="modal-body">
          Vous pouvez aussi utiliser nos extentions pour ajouter des musiques directement depuis Youtube !
          <div class="row">
            <div class="col-md-offset-1 col-md-4">Firefox :
              <a href="https://addons.mozilla.org/fr/firefox/addon/amoki-music/" target="_blank">
                <img src="{% static 'img/firefox-logo.png' %}" width="120px" height="120px">
              </a>
            </div>
            <div class="col-md-offset-2 col-md-4">Google Chrome :
              <a href="https://chrome.google.com/webstore/detail/amoki-music/ieinfogigllinbiihpecpopcmkdopadm" target="_blank">
                <img src="{% static 'img/chrome-logo.png' %}" width="120px" height="120px">
              </a>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-info" data-dismiss="modal">Fermer</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade modal-on-top" id="modal-shuffle-on">
    <div class="modal-dialog modal-sm">
      <div class="modal-content modal-content-custom">
        <div class="modal-body">
          <p class="col-xs-8">Everyday i'm shuffling</p>
          <i class="fa fa-music fa-2x col-xs-1"></i>
          <button type="button" class="close col-xs-1 col-xs-offset-1" data-dismiss="modal">x</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade modal-on-top" id="modal-shuffle-error">
    <div class="modal-dialog modal-sm">
      <div class="modal-content modal-content-custom">
        <div class="modal-body">
          <p class="col-xs-8">You can't shuffle with 0 musics !</p>
          <i class="fa fa-music fa-2x col-xs-1"></i>
          <button type="button" class="close col-xs-1 col-xs-offset-1" data-dismiss="modal">x</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade modal-on-top" id="modal-shuffle-off">
    <div class="modal-dialog modal-sm">
      <div class="modal-content modal-content-custom">
        <div class="modal-body">
          <p class="col-xs-8">Shuffle is off</p>
          <span class="fa-stack fa-lg col-xs-1">
            <i class="fa fa-music fa-stack-1x"></i>
            <i class="fa fa-ban fa-stack-2x"></i>
          </span>
          <button type="button" class="close col-xs-1 col-xs-offset-1" data-dismiss="modal">x</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade modal-on-top" id="modal-add-music">
    <div class="modal-dialog modal-sm">
      <div class="modal-content modal-content-custom">
        <div class="modal-body">
          <p>Music added to the playlist ;)</p>
          <button type="button" class="close" data-dismiss="modal">x</button>
        </div>
      </div>
    </div>
  </div>
  <div class="tooltip tooltip1"></div>
  <div class="tooltip tooltip2"></div>
  <div class="modal fade" id="music_preview">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Preview</h4>
        </div>
        <div id="preview_player">Youtube Player</div>
        <div class="modal-body">
          <div id="slider"></div>
          <p>
            <label for="">Time range:</label>
            <span id="time_start" style="font-weight:bold;"></span>
            <span> - </span>
            <span id="time_end" style="font-weight:bold;"></span>
          </p>
          <div id="music-channel"></div>
          <div id="music-description"></div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-info" id="btn-modal-preview-valid" data-dismiss="modal">Ajouter</button>
          <button class="btn btn-info" id="btn-modal-preview-cancel" data-dismiss="modal">Annuler</button>
        </div>
      </div>
    </div>
  </div>
  <script type="text/javascript">
    var player;
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    function onYouTubeIframeAPIReady() {
      player = new YT.Player('preview_player', {
        height: '300px',
        width: '100%',
        playerVars: {
          iv_load_policy: '3',
          modestbranding: '1',
          rel: '0',
          autoplay: '0'},
        });
    }
  </script>
</body>
</html>
