{% load static %}

<!DOCTYPE html>
<html>
  <head>
	<title>Accueil</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta http-equiv="content-language" content="fr" />
	<link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
	<link href="{% static 'css/style.less' %}" rel="stylesheet/less">
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
	<script src="//cdnjs.cloudflare.com/ajax/libs/less.js/1.7.5/less.min.js"></script>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script type="text/javascript" src="{% static 'js/bootstrap.min.js' %}"></script>
	<script type="text/javascript" src="{% static 'js/prefixfree.min.js' %}"></script>
	<script type="text/javascript">
		$( document ).ready(function() {
				var hauteur = $(window).height() - 110;
				$(".LIB").height(hauteur);
				$(".player").height(hauteur - 50);
				$(".list-lib").height(hauteur - 100);
				$(".panel-playlist").height(hauteur - 300);     
				$( window ).resize(function() {
					if ($(window).width() > 992) {
						if ($(window).height() > 500) {
							var hauteur = $(window).height() - 110;
							$(".LIB").height(hauteur);
							$(".player").height(hauteur - 50);
							$(".list-lib").height(hauteur - 100);
							$(".panel-playlist").height(hauteur - 300); 
						}
					}
				});
		});
	</script>

	{% if playing %}
	<style type="text/css">
			.progress-bar {
				animation: timeline-progress {{current_time_left}}s 1 forwards linear;
			}
			@keyframes timeline-progress {
				0%   {width: {{current_time_past_percent}}%;}
				100% {width: 100%;}
			}
	</style>
	{% endif %}

	</head>
	<body>
	<div class="container-fluid">
		<div class="navbar navbar-inverse row">
			<ul class="nav navbar-nav">
				<li class="active"> <a href="#">Accueil</a> </li>
				<li> <a href="#">WIP..</a> </li>
			</ul>
			<form action="." method="post" class="navbar-form pull-right">
				{% csrf_token %}
				<button type="submit" class="btn btn-default btn-vol"name="volume_down" value="volume_down" title="volume_down" alt="volume_down"><i class="fa fa-volume-down fa-2x"></i></span></button>
				<button type="submit" class="btn btn-default btn-vol" name="volume_up" value="volume_up" title="volume_up" alt="volume_up"><i class="fa fa-volume-up fa-2x"></i></span></button>
			</form>
		</div>
		<div class="row ligne">
			<div class="col-md-offset-1 col-md-6 player">
				<div class="row">
					{% if playing %}
					<img id="thumbnail" src="{{playing.thumbnail}}" width="120px" height="90px" class="col-md-offset-1 col-md-3 img-responsive"></img>
					<div class="col-md-7 title_playing">
						<div class="marquee">
							<a href="{{video_url}}" class="now-playing">{{ playing }}</a>
						</div>
					{% else %}
					<div class="col-md-12 title">
						<div class="marquee">
							<span class="now-playing">No music :'( Add yours now !</span>
						</div>
					{% endif %}
					</div>
				</div>
				<!-- PLAYLIST -->
				<div class="row playlist">
					<div class="col-md-offset-1 col-md-10">
						<div class="panel panel-default panel-playlist">
							<table class="table table-striped table-condensed header-fixed">
								<div class="panel-heading">
									<h3 class="panel-title">Playlist</h3>
								</div>
								<tbody>
									{% if playing and nexts_music|length > 0 %}
										{% for music in nexts_music %}
											<tr>
												<td>{{music.name}}</td>
												<td><span class="badge">00:00</span></td>
											</tr>
										{% endfor %}
									{% elif shuffle %}
										<span class="gris" style="font-size:22px;font-weight:bold;text-align:center;color:black;">Shuffle activated...<br /><br />Let the music be your guide</span>
									{% else %}
										<span class="gris" style="margin-left:-22px;font-size:22px;font-weight:bold;text-align:center; color: black;">No more musics in the playlist !</span>
									{% endif %}
								</tbody>
							</table>
						</div>
					</div>
				</div>
				<!-- PROGRESS BAR -->
				<div class="row">
					<div class="col-md-offset-1 col-md-10">
						<div class="progress progress-striped popover-on-top">
							<div class="progress-bar"></div>
						</div>
					</div>
				</div>
				<!-- CONTROL BUTTONS -->
				<div class="row">
					<div class="col-xs-offset-2 col-xs-3">
						<form action="." method="post" class="input-group">
							{% csrf_token %}
							<button type="submit" name="shuffle" class="btn btn-default btn-control" {%if shuffle %}value="false"{% else %}value="true"{% endif %} title="Shuffle" alt="Shuffle"/>
								<i class="fa fa-random fa-2x"></i>
							</button>
						</form>
					</div>
					<div class="col-xs-offset-3 col-xs-4">
						<form action="." method="post" class="input-group">
							{% csrf_token %}
							<button type="submit" name="play_next" value="Next music" title="Next Music" alt="Next Music" {% if not playing %}disabled="disabled"{%endif%} class="btn btn-default btn-control"><i class="fa fa-fast-forward fa-2x"></i></button>
						</form>
					</div>

				</div>
			</div>

			<!-- LIBRARY  -->

			<div class="col-md-offset-1 col-md-4 LIB">
				<div class="row input-lib">
					<div class="col-md-offset-0 col-md-12">
						<form action="." method="post" class="input-group">
						{% csrf_token %}
							<input id="input-search" type="text" name="url" class="form-control" style="text-align:right" placeholder="Titre">
							<span class="input-group-btn">
								<button class="btn btn-default" type="submit" title="Chercher sur Youtube" alt="Chercher sur Youtube"><i class="fa fa-youtube-play"></i></span> Youtube-moi</button>
							</span>
						</form>
					</div>
				</div>
				<div class="row list-lib">
					<div class="col-md-12">
						<ul class="list-group">
							{% for music in musics %}
								<li class="list-group-item item-lib list-music">   
									<form action="." method="post" class="pull-right">
										{% csrf_token %}
										<input type="hidden" value="{{ music.video_id }}" name="url">
										<button class="btn btn-default btn-lg" type="submit" alt="Ajouter à la playlist" title="Ajouter à la playlist">
											<span class="glyphicon glyphicon-headphones"></span>
										</button>
									</form>                             
									{{ music.name }}
								</li>
							{% endfor %}
						</ul>
					</div>
				</div>
			</div>
		</div>
	<footer class="row foot">
			<div class="pull-right">
				Wip...
			</div>
	</footer>
	</div>

	{% if playing %}
	
		<script type="text/javascript">
			$(".popover-on-top").popover({
					placement : 'top',
					trigger : 'hover',
					content : '0:00:00'
			});
			var popover = $('.popover-on-top').data('bs.popover');
			var actual_time = parseInt("{{current_time_left}}");
			var heures = Math.floor(actual_time / 3600);
			var minutes = Math.floor((actual_time - (heures * 3600)) / 60);
			var secondes = actual_time - (heures * 3600) - (minutes * 60) ;
			var printedTime = "";
			function compteur() {
				if(secondes === 0) {
					secondes = 59;
					if(minutes === 0) {
						minutes = 59;
						if(heures === 0){
							window.location.reload();
							clearInterval(intervalCompteur);
							return true;
						}
						else
							heures--;
					}
					else
						minutes--;
				}
				else {
					secondes--;
				}
				var stantardize = function(num){
					if (num < 10) {
						printedTime += "0";
					}
				};
				printedTime = heures+":";
				stantardize(minutes);
				printedTime += minutes+":";
				stantardize(secondes);
				printedTime += secondes;
				$('.popover-on-top').attr('data-content', printedTime);
				popover.setContent();
				popover.$tip.addClass(popover.options.placement);
			}
			var intervalCompteur = setInterval("compteur()",1000);
		</script>
	{% endif %}
	<script>
		//Override de la fonction "contains" pour permettre une recherche case-insensitive
		jQuery.expr[':'].contains = jQuery.expr.createPseudo(function(arg) {
			return function( elem ) {
				return jQuery(elem).text().toUpperCase().indexOf(arg.toUpperCase()) >= 0;
			};
		});
		//Recherche basée sur le champs input "input-search"
		$("#input-search").keyup(function(){
			var strToSearch = $("#input-search").val();
			$(".list-music:not(:contains('"+strToSearch+"'))").slideUp();
			$(".list-music:contains('"+strToSearch+"')").slideDown();
		});
	</script>
	</body>
</html>